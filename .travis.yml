services:
  - docker

language: generic

script:
  - make build

after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=oinker/oinker-admin
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker push $REPO

env:
  global:
    - secure: "nv2tX9SpXi6VmyPCi+aKLm/pRwM/HqEPpHTwdhukrCpip1BHT9JMKmqatBptdYiiB+dokiDT+I43wo51MrB1sLof3wsAzVUlEkCDIpsFDX/SCOpC/Uhharwh0wsbDPf9fInOdCX3PrUmzfwsddBgkpao5Y7BvfUNzFfYZtzXz1Fb6H9gbQ3irDlcIcP48vJ/1roFgGOmiFwPiEo49g+b8cgNjUXKGLiXpnoCMtR2jNZVZtyQba4WFzGwtXKQo6Br+42z8PhbFB2w/ik/N4d8tOs9IqHjhDckJebQkLZ/HSBnu0R/MVPpt6Y6HThe0IonhK42qr8mFtK+bKhzNH9h7tIwpfzt0fGGLqjFSA5gkl3J3+LhNIuai6ijExMFZ1PxQX8VI+KQqC4k1N7crbX1emKEPrxqgYXo4OxGBH7GNb5NEME89RwJ8vrIZxgvkYJiffB89swAKCFy5LmAlGM6vK6GnZbWVUidZO36J3CU7TI1McMUqBgzhKggW8hC1Haf2LGVXW/h26zGL96dHRuvTBI/YWPv2nc/2vBLqktGmG7z50dpPrHfhLk7T9cHacVGFRnV9t8rYU5CxCm6iuAvzcTHrf5KVBZkH288UNcW9pcbKY11i7+xN+pwS9XPemDEFiRqacRHxuOTm8LN5pBw9TBd4hMPRf9mQNWmTFiGlZs=" # DOCKER_EMAIL
    - secure: "Nc2YKN9W2yqWQMjZLDEoaqvIPjgw63fhmLKwZPq/Td+LoaRpuYBwQGqwejz0HuBT9sMvVTT5HNSglm1Gkhowj5XdDs+8cxhVI2y4u0+wcAiIAJiv5zHgR5fXG3on2ca+C+GIMNJOFd0wqlNygM0fxwQHHV0Nh7dyEN8eyHShKxhdGWxZpjYonyqNdI0hi28rWfHwQQaMWTXqUmr2MDb7419llQe3PvfGD+QimGPVna30sX+BUJNFqbB/5lyWNHaCMDgLd3Nf16rKsAbfxBqngoQY8tK0DTs9fh8rf9T27lH7SCc0GIDEH0DlprJiRLKwYRDCqahfDJJmlW2Np6POJJhR9D5HMCxRozKs2ypFZiCKblYwy4xAuaMTrJNyp6xCQoSLX8c/SB8R2E5ar3EQzRCGVligdC31YBLK+qlT/Um/HoVtH0HOhkhmCB0vZIZ+YMTO3dIccNxVUVxciojX6grsDpuylOKBzSlEIeO7Yq6Jn6SDGwQEGxLq67e2zrX+PdqcTvgMTFhde/CWKke5bbX4DytMqYywWilJhMpr75AsJ1/OeRg3lBNCZp1QXDicQvSkN7xH1pCH28+zYKvaCx78fiIFMQI0Xetf/02Smtk2BwfHfD/l56+C1FuXFT2LdE68FmReutVm0HP/HgNBakZiJrIMUKO7i0ZGWVYYmGA=" # DOCKER_USER
    - secure: "LfFi7hNzovuPzirDqgSLF3dXoW0RUGhCSjPL6v0jzje62lJyebIc2p0RBoXPfCTdHml4f7Z+XeKlBtUeJWEGxcyRr0DiA5Zlskod+zdVp2Mm+HLCemjyME97j2NDQhMJZL6M+hW0m7fTrLvjJ46Twj1UT30aW1lbzybOGcDjoFBAAYe5sQOJSRpQ+y6y82bFJeMu7Ab0el+rNZxUs++b6D+Jsqss5EvEQ3YTUscZs4N5gecrhNZYeCd/GCP9bYbFMgrBMzZdV2SbZsJVy2lqXnTZr4HQLZIP18kBr4t7OcPokNYfFpmPQBrnA7zJq3ZynUZQUvOWNEvDXYsBKAx9kPyIsbq63BFLRnw2yxZCozkBT6s0YDvQcV4XN6TuUwEiuDo9OXwdOjhSPkrw2AyULZZMKf9kEiNM32W8k5+pW9hzaUnENflOy1LXzxVzExsDgZzyWzkjmX9BvTtFc1Pw/1cDcp36CUGUbAensJ1indYSIh/fJJk2EfbXJLeRRitKzRnBYRLMAWTcugom25v3NRd+FIVDeUaRBIkJ6cdqPIQlxBaTE2Mk+h9zQN5dcuJEF9BVefb/n28rxTZxVKsMA3DICDwrcSS2CdiAUrgkiYSWNv2KJJqtwMYG3Y70u0iRA0hhwKbtowP26vdbvPWW+uT14gBrAle14Y75ZJ7jzOM=" # DOCKER_PASS
    - COMMIT=${TRAVIS_COMMIT::6}